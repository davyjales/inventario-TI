# TODO - Implementa√ß√£o Separa√ß√£o Snapshot vs Changed Fields

## Status: EM ANDAMENTO

### ‚úÖ COMPLETADO:
- [x] An√°lise da estrutura atual
- [x] Cria√ß√£o do plano detalhado
- [x] Aprova√ß√£o do usu√°rio

### üîÑ EM ANDAMENTO:
- [x] Adicionar coluna `snapshot` na tabela `equipment_history`
- [x] Atualizar `utils/cloneEquipmentToHistory.js`
- [x] Atualizar `services/historicoService.js`
- [x] Atualizar `js/historico.js`
- [ ] Testes das funcionalidades

### üìã DETALHES DOS PASSOS:

#### 1. Modificar Banco de Dados ‚úÖ
- [x] Adicionar coluna `snapshot` TEXT na tabela `equipment_history`
- [x] Manter coluna `changed_fields` para compatibilidade

#### 2. Backend - utils/cloneEquipmentToHistory.js
- Modificar fun√ß√£o para salvar snapshot completo na coluna `snapshot`
- Manter `changed_fields` apenas para updates com diferen√ßas
- Fluxo:
  - Create/Consulta: `snapshot` = estado completo, `changed_fields` = {}
  - Update: `snapshot` = estado completo antes da mudan√ßa, `changed_fields` = diferen√ßas
  - Delete: `snapshot` = √∫ltimo estado, `changed_fields` = {}

#### 3. Backend - services/historicoService.js
- Atualizar queries para buscar coluna `snapshot`
- Modificar l√≥gica para usar `snapshot` como fonte prim√°ria dos detalhes
- Manter `changed_fields` apenas para bot√£o "Mostrar Altera√ß√µes"
- Remover l√≥gica complexa de reconstru√ß√£o de snapshots

#### 4. Frontend - js/historico.js
- Modificar para usar `snapshot` como fonte dos detalhes do equipamento
- Manter `changed_fields` apenas para bot√£o de mostrar altera√ß√µes
- Simplificar l√≥gica de exibi√ß√£o dos detalhes

#### 5. Testes
- Testar create, update, delete, consulta
- Verificar se detalhes mostram snapshot completo
- Verificar se bot√£o "Mostrar Altera√ß√µes" funciona
